# 图聚类算法研究

> 2017/4/22
>
> 在 [学习虚拟网络映射算法](Virtual-Network-Embedding-Study-Share.md) 过程中，和图聚类算法相关的学习

[heading-numbering]

## [no-toc] [no-number] 目录

[TOC]

## 什么是图聚类

**聚类** 是根据数据类似相似度，将数据进行分类（或分组）的过程，是一种无监督学习的过程。
聚类过程中，分组的依据是 **聚类相似度（系数）**，用于定义数据之间的聚合程度。
聚类的任务就是利用无监督学习的方法，根据数据之间的相似度，将数据分成多个类。

**图聚类** 的任务是，对于给定图 $G = (V, E)$（其中 $V$ 为节点的集合，$E$ 为节点之间的边的集合）和 $G$ 上节点间的相似度，对节点和边进行分组，得到若干个 **簇**；
每个 **簇** 包含若干节点和所有这些节点之间的边，**连接簇的边** 是跨簇的节点之间的边，并保证所有 **簇** 和 **连接簇的边** 构成原来的图。[clustering survey]

一些文献把图聚类中的图叫做 **社区**；在社交网络相关研究中，**图聚类** 方法被应用于 **社区发现**。[community structure] [community detection]

## 聚类相似度的衡量

**聚类相似度（系数）** 定义了数据之间是否应该聚合在一起的程度，是聚类的无监督学习的依据。
在不同的应用场景下，为了达到不同的聚类目的，使用不同的聚类相似度 **衡量方法**。

常见的聚类相似度的衡量方法有：**节点相似度** 和 **簇相似度**。[clustering survey]

### 节点相似度

**节点相似度** 用于衡量图中节点之间的相似情况。计算出节点相似度后，聚类算法可以根据节点之间的相似情况，将相似的节点聚在同一个簇，不相似的节点分在不同的簇。

常用的节点相似度计算方法有：

- 距离相似度
- 邻接相似度
- 连通性相似度

#### 距离相似度

**距离相似度** 是根据两个节点之间距离，计算节点相似度的方法。

在 $n$ 维**欧几里德空间** 中，对于图中任意两个节点，可以写成两个向量 $v_i = (v_{i1}, v_{i2}, ..., v_{in})$ 和 $v_j = (v_{j1}, v_{j2}, ..., v_{jn})$ 的形式。

所以，**欧几里德距离相似度** 可以用以下公式计算：

$$
dist_e (v_i, v_j) = \sqrt{ \sum_{k = 1}^n (v_{ik} - v_{jk})^2 }
$$

而 **曼哈顿距离相似度** 可以用以下公式计算：

$$
dist_m (v_i, v_j) = \sum_{k = 1}^n | v_{ik} - v_{jk} |
$$

但是许多网络中，图的节点很难映射到一个 $n$ 维欧几里德空间上，所以可以使用其他距离计算方法。例如，对于给定两个节点，其数据是 **串** 的形式，我们就可以使用 **编辑距离** 计算其相似度。[string distance]

#### 邻接相似度

**邻接相似度** 是根据节点的邻接信息，即节点和与其相邻的节点的连接情况，计算节点相似度的方法。利用节点邻接情况，不需要节点的向量信息（欧几里德空间上的坐标 或 串），就可以计算节点之间的相似度。

在一个 **无向图** 上，对于任意两个节点 $v_i$ 和 $v_j$，它们之间的 **Jaccard 相似度** 可以表示为 [jaccard]：

$$
J (v_i, v_j) = \frac{|A (v_i) \cap A (v_j)|} {|A (v_i) \cup A (v_j)|}
$$

其中，$A (v_i)$ 和 $A (v_j)$ 分别是 $v_i$ 和 $v_j$ 的邻接节点集。

#### 连通性相似度

**连通性相似度** 根据任意两个节点在图上的连通程度，判断两个节点是否应该在同一个簇内。例如：

- 可以计算图上 **任意两点间的路径数目**；路径数目越多，**连通相似度** 就越大。[connectivity count]
- 或者计算图上 **任意两点间的最短路径**；最短路径越短，**连通相似度** 也越大。[connectivity shortest]

### 簇相似度

**簇相似度** 用于衡量图中 **簇内部** 或 **簇之间** 的相似情况。簇相似度常用于衡量一个聚类情况的优劣，但也可以用在聚类算法中。一些聚类算法通过计算簇相似度，判断簇内部的聚集程度，进一步考量 **簇划分** 的好坏程度，从而做出最优的聚类决策。

可以将 **簇的集聚系数** 作为簇的相似度，衡量簇内部的聚集程度。给定一个图 $G$，其 **集聚系数** 可以通过以下公式计算 [social network]：

$$
C_{total}(G) = \frac {3 \times G_{\triangle} }{3 \times G_{\triangle} + G_{\land} }
$$

其中，$G_{\triangle }$ 是 $G$ 内 **闭三点组** 的个数（如果三个节点两两相邻接，即构成一个三角形，是一个闭三点组），$G_{\land }$ 是 $G$ 内 **开三点组** 的个数（如果三点之间连有两条边，即构成缺一条边的三角形，是一个开三点组）。在完全图中的 **集聚系数** 等于 $1$。

## 聚类方法

衡量了聚类相似度之后，我们可以通过特定的聚类方法，将给定的图，划分为满足聚类相似度特性的簇的集合，即使得相似度高的点在同一个簇，相似度低的点在不同的簇。

目前主要的聚类方法分为 全局聚类 和 局部聚类 两种 [clustering survey]：
- **全局聚类** 整体考虑整个图，将所有的节点根据相似度，分到不同的簇。
- **局部聚类** 每次仅考虑一个局部（例如一个节点），将通过局部的聚合，得到该局部对应的簇，然后通过簇的合并，得到最后的聚类结果。

### 全局聚类

全局聚类已被学者广泛研究，目前有很多各式各样的方法。其中比较常用的方法有：**K 均值聚类** 和 **马尔科夫聚类**。前者使用 **向量的距离相似度** 作为节点之间相似度的衡量标准；后者则使用任意的 **节点相似度** 计算方法作为衡量。

#### K 均值聚类

**K 均值聚类** 是典型的基于距离的聚类算法，其核心思想是把 节点 到 目标簇的质心 的距离作为优化的目标函数，利用求极值的方法，迭代调整质心，直到最优。[k means]

算法过程如下：

1. 从 $n$ 个节点随机选取 $k$ 个节点作为 **质心**
2. 对剩余的每个节点计算其到各个质心的 **距离**，并把它归到最近的质心的 **簇**
3. 重新计算已经得到的各个 **簇的质心**
4. 迭代 $2 - 3$ 步，直至新的质心与原质心相等或小于指定阈值，算法结束

#### 马尔科夫聚类

**马尔科夫聚类** 基于马尔科夫链的 **随机游走** 思想，利用 **流模拟** 的方法划分簇。[mcl]

其 **核心思想** 是：让聚类的结果使得，各个簇内部的相似度很高，而簇之间的相似度很低；即在图上，簇内的边的权值大，而簇间的边的权值小。对应于 **随机游走** 就是：在有限跳数内，如果从任意一个点开始，最终达到某一个节点，这个节点更可能是同一个簇内的节点。

算法过程如下：

1. 给无向图的 **邻接矩阵**，**加上自环**
2. 把矩阵 **按列单位化**，变为 **左随机矩阵**
3. **展开矩阵**，即做 $e$ 次幂运算
4. **压缩矩阵**，即矩阵每个元素做 $r$ 次幂运算
5. 重复 $2 - 4$ 步，直至矩阵不再变化，即收敛
6. 随机矩阵中，每一行的所有非 $0$ 元素对应列的节点划分为同一个 **簇**，算法结束

### 局部聚类

当数据规模十分巨大的时候，如果直接将所有的数据统一计算，消耗大量的资源。**局部聚类** 利用数据的局部信息，将数据在各个局部上分别聚类。

为了综合得到整体的聚类结果，可以使用 **层次聚类** 的方法，将各个局部的聚类结果（簇）合并为更大的簇，直到不能再合并为止。

算法过程如下：

1. 把 **每个节点** 归为一个 **簇**
2. 计算 **每两个簇之间的相似度**
2. 寻找各个簇之间 **相似最高的两个**，**聚为一个簇**
4. 重复 $2 - 3$ 步，直到不能再继续聚合或相似度小于一个阈值，算法结束

## 在虚拟网络映射上的应用

在虚拟网络映射中，每个虚拟网络请求包含了多个节点和节点之间的链路，而每个节点都有地理域 (domain) 的限制；物理网络包含了多个地理域，而每个域都有随着时间变化的电价。虚拟网络映射算法的目标，一方面是提高映射成功率，增加收入；另一方面是减少能耗，降低成本。

**能耗成本** 的影响因素主要有两个方面：电价和功耗；能耗成本与这两个因素成正相关。

- 为了 **减少电价**，需要尽可能的把虚拟网络请求映射到电价更低的域上；
- 为了 **降低功耗**，需要尽可能的增大映射的聚集程度，减少开启结点的数量，同时减少跨域链路的功耗。

为了实现能耗成本更低的虚拟网络映射算法，我们可以使用聚类的方法，先对请求中的节点按照域分组，然后再映射到物理网络上。

### 传统算法的不足

传统的聚类算法在虚拟网络映射上不能被直接应用：

1. 聚类是一种 **无监督学习**，而虚拟网络请求带有物理域限制；聚类的过程是不可控的，所以聚类的结果不一定满足这个限制；
2. 常用的 **聚类相似度** 衡量方法不适用于虚拟网络映射，因为我们的目标是在减少电价的同时降低功耗；为了达到这个目标，我们需要重新定义相似度的计算方法。

### 聚类算法的改进

为了弥补传统方法的不足，我们提出了新的方法：

- 首先，定义了 **相似度的计算方法**；
- 其次，根据计算出的相似度，我们提出了 **虚拟网络节点的聚类算法**；
- 最后，根据聚类的结果，把同一个簇上的节点映射到同一个物理域上。

## [no-number] 参考文献

[cite-sec]

- [clustering survey]: Satu Elisa Schaeffer, Graph clustering. _Computer Science Review_, 1(1): 27-64 (2007).
- [community structure]: M. Girvan, M. E. J. Newman, Community structure in social and biological networks. _Proceedings of the National Academy of Sciences of the United States of America_, 99(12): 8271–8276 (2002).
- [community detection]: Santo Fortunato, Community detection in graphs. _Physics Reports_, 486(3): 75-174 (2009).
- [string distance]: W. W. Cohen, P. D. Ravikumar, S. E. Fienberg, A Comparison of String Distance Metrics for Name-Matching Tasks. _International Joint Conference on Artificial Intelligence_ (2003).
- [jaccard]: P. Jaccard, Distribution de la flore alpine dans le bassin des Dranses et dans quelques régions voisines. _Bulletin de la Société Vaudoise des Sciences Naturelles_, 37(140): 241-272 (1901).
- [connectivity count]: E. Hartuv and R. Shamir, A Clustering Algorithm based on Graph Connectivity. _Information Processing Letters_, 76(4): 175-181 (2000).
- [connectivity shortest]: J. Edachery and A. Sen and F. J. Brandenburg, Graph Clustering Using Distance-k Cliques. _Graph Drawing_ (1999).
- [social network]: S. Wasserman and K. Faust, Social Network Analysis: Methods and Application. Cambridge: Cambridge University Press (1994).
- [k means]: J. A. Hartigan and M. A. Wong, Algorithm AS 136: A K-Means Clustering Algorithm . _Journal of the Royal Statistical Society. Series C (Applied Statistics)_, 28(1): 100-108 (1979).
- [mcl]: S. M. van Dongen, Graph Clustering by Flow Simulation, Ph.D. Thesis. _Universiteit Utrecht, The Netherlands_ (2000).